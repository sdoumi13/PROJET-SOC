<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <title>Analyse - {{ result.event.id }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { soc: { bg: '#0f172a', card: '#1e293b' } } } } }
    </script>
</head>
<body class="bg-soc-bg text-slate-200 min-h-screen font-sans p-8">

    <div class="max-w-6xl mx-auto">
        <div class="flex items-center justify-between mb-8">
            <div>
                <a href="/" class="text-slate-400 hover:text-white mb-2 inline-block">&larr; Retour au Dashboard</a>
                <h1 class="text-3xl font-bold text-white">Analyse √âv√©nement <span class="text-blue-500">{{ result.event.id }}</span></h1>
                <p class="text-slate-400 mt-1">{{ result.event.timestamp }} | {{ result.event.event_type }}</p>
            </div>
            
            <div class="text-right">
                <div class="text-sm text-slate-400">Niveau de Menace</div>
                <div class="text-2xl font-bold 
                    {{ 'text-red-500' if result.explanation.scores.threat_level == 'HIGH' else 
                       'text-yellow-500' if result.explanation.scores.threat_level == 'MEDIUM' else 
                       'text-green-500' }}">
                    {{ result.explanation.scores.threat_level }}
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-2 space-y-6">
                <div class="bg-soc-card rounded-lg border border-slate-700 p-6 shadow-lg">
                    <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">üí¨ Explication XAI (LLM)</h2>
                    <div class="prose prose-invert max-w-none text-slate-300">
                        <p>{{ result.explanation.explanation }}</p>
                    </div>
                    
                    <div class="mt-6 space-y-3">
                        <h3 class="font-semibold text-white">Recommandations :</h3>
                        {% for rec in result.explanation.recommendations %}
                        <div class="flex items-start gap-3 bg-slate-800/50 p-3 rounded border border-slate-700">
                            <span class="text-xs font-bold px-2 py-1 rounded {{ 'bg-red-900 text-red-200' if rec.priority == 'HIGH' else 'bg-blue-900 text-blue-200' }}">
                                {{ rec.priority }}
                            </span>
                            <div>
                                <p class="font-medium text-white">{{ rec.action }}</p>
                                <p class="text-sm text-slate-400">{{ rec.description }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="bg-soc-card rounded-lg border border-slate-700 p-6">
                    <h3 class="font-bold text-white mb-2">Message Brut</h3>
                    <pre class="bg-black/50 p-4 rounded text-sm text-green-400 font-mono overflow-x-auto">{{ result.event.message }}</pre>
                </div>
            </div>

            <div class="space-y-6">
                <div class="bg-soc-card rounded-lg border border-slate-700 p-6">
                    <h3 class="font-bold text-white mb-4">Scores IA</h3>
                    
                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-slate-400">Anomaly Score</span>
                            <span>{{ "%.3f"|format(result.anomaly_score) }}</span>
                        </div>
                        <div class="w-full bg-slate-700 rounded-full h-2">
                            <div class="bg-purple-500 h-2 rounded-full" style="width: {{ result.anomaly_score * 100 }}%"></div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="text-slate-400">Trust Score</span>
                            <span>{{ "%.3f"|format(result.trust_score) }}</span>
                        </div>
                        <div class="w-full bg-slate-700 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: {{ (result.trust_score * 100)|int }}%"></div>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t border-slate-700">
                         <div class="flex justify-between text-sm">
                            <span class="text-slate-400">Confiance LLM</span>
                            <span class="text-white font-mono">{{ "%.0f"|format(result.llm_analysis.confidence * 100) }}%</span>
                        </div>
                    </div>
                </div>

                <div class="bg-soc-card rounded-lg border border-slate-700 p-6">
                    <h3 class="font-bold text-white mb-4">üó∫Ô∏è Mapping MITRE</h3>
                    {% if result.mitre_techniques %}
                        <div class="space-y-3">
                        {% for tech in result.mitre_techniques %}
                            <div class="border-l-2 border-red-500 pl-3">
                                <div class="flex justify-between">
                                    <span class="font-bold text-red-400 text-sm">{{ tech.technique_id }}</span>
                                    <span class="text-xs text-slate-500">{{ "%.0f"|format(tech.confidence * 100) }}%</span>
                                </div>
                                <p class="text-sm text-white">{{ tech.technique_name }}</p>
                                <p class="text-xs text-slate-400 italic">{{ tech.tactic }}</p>
                            </div>
                        {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-slate-500 text-sm">Aucune technique d√©tect√©e.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</body>
</html>